<!doctype html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no" />

  <title>Mobilab CMS</title>

  <link rel="shortcut icon" href="../assets/favicon.png" sizes="64x64">

</head>

<body>
  <!-- Include the script that builds the page and powers Netlify CMS -->
  <script src="https://unpkg.com/netlify-cms@^2.9.0/dist/netlify-cms.js"></script>

  <script>
    CMS.registerPreviewStyle("https://mobilab.mobidays.com/assets/lib/normalize.css");
    CMS.registerPreviewStyle("https://mobilab.mobidays.com/assets/css/monokai.css");
    CMS.registerPreviewStyle("https://mobilab.mobidays.com/assets/lib/magnific-popup.min.css");
    CMS.registerPreviewStyle("https://mobilab.mobidays.com/assets/css/screen.css");

    var PostPreview = createClass({
      render: function() {
        var entry = this.props.entry;
        var image = entry.getIn([ 'data', 'image' ]);
        // var bg = this.props.getAsset(image) || '/assets/images/default_blog_cover.jpg';
        var bg = this.props.getAsset(image) || '';
        var author = entry.getIn([ 'data', 'author' ]) || 'dev';

        var coverLink = this.props.widgetsFor('cover').getIn(['data', 'link']) || '';
        var coverTitle = this.props.widgetsFor('cover').getIn(['data', 'title']) || '';
        var date = entry.getIn([ 'data', 'date' ]) || '';
        date = date.split(' ')[0].replace(/-/gi,'/');

        return h('div', { id: 'wrapper' },
            h('div', { id: 'cover', 'className': 'container', style: { 'background-image': 'url('+ bg.toString() +')' } },
                h('div', {},
                    h('h1', {}, entry.getIn([ 'data', 'title' ]) ),
                    h('p', { style:{ 'color': 'white !important' } }, date, ' by ',
                        h('b', { style: { 'font-size': '11px' } },
                            h('a', { href: '/authors/' + author }, author )
                        )
                    ),

                    h('cite', {},'커버 이미지 출처: ',
                        h('a', { href: coverLink, target: '_blank'}, coverTitle || coverLink )
                    )

                )
            ),
            h('div', { id: 'content', 'className': 'container post', role: 'main' },
                h('div', { id: 'post-content' },
                    h('p', {},
                        this.props.widgetsFor('tags').map(function(tag, index) {
                          return h('a', { 'className': 'tag', href: '/tags/'+tag.getIn([ 'data' ])},
                            '#', tag.getIn([ 'data' ])
                          );
                        })
                    ),
                    this.props.widgetFor('body')
                )
            ),
         );
      }
    });

    var AuthorPreview = createClass({
      render: function() {
        var entry = this.props.entry;
        var image = entry.getIn([ 'data', 'image' ]);
        var thumbnail = this.props.getAsset(image) || '/static/authors/default.png';
        var bg = '/assets/images/default_blog_cover.jpg';
        var authorSubName = (entry.getIn([ 'data', 'name' ])!=entry.getIn([ 'data', 'title' ]))?'('+entry.getIn([ 'data', 'title' ])+')':'';
        var authorEmail = (entry.getIn([ 'data', 'email' ]))?'<'+entry.getIn([ 'data', 'email' ])+'>':'';

        return h('div', { id: 'wrapper' },
            h('div', { id: 'cover', 'className': 'container', style: { 'background-image': 'url('+ bg.toString() +')' } },
                h('div', {},
                    h('div', { id: 'cover-author-image', style: { 'background-image': 'url('+ thumbnail.toString() +')' } },
                        h('span', { 'className': 'sr-only' }, entry.getIn([ 'data', 'title' ]) )
                    ),
                    h('div', {},
                        h('h1', {}, entry.getIn([ 'data', 'name' ]) || entry.getIn([ 'data', 'title' ]),
                            h('b', { style: { 'font-size': '11px' } }, authorSubName )
                        )
                    ),
                    h('p', { style: { 'padding-top': '1px' } }, entry.getIn([ 'data', 'desc' ]) )
                )
            ),
            h('br', {} ),
            h('hr', {} ),
            h('div', { id: 'content', 'className': 'container post', role: 'main' },
                h('div', { id: 'post-footer' },
                    h('a', { id: 'post-author' },
                        h('div', { id: 'author-image', style: { 'background-image': 'url('+ thumbnail.toString() +')' } },
                            h('span', { 'className': 'sr-only' }, entry.getIn([ 'data', 'title' ]) )
                        ),
                        h('p', { id: 'author-name', style: { 'font-weight': 'bold' } }, entry.getIn([ 'data', 'title' ]),
                            h('b', { style: { 'font-size': '11px' } }, authorEmail )
                        )

                    ),
                    h('p', { id: 'post-date' }, entry.getIn([ 'data', 'desc' ]) )
                )
            ),
            h('hr', {} )
         );
      }
    });

    CMS.registerPreviewTemplate("posts", PostPreview);
    CMS.registerPreviewTemplate("drafts", PostPreview);

    CMS.registerPreviewTemplate("authors", AuthorPreview);


  </script>

</body>

</html>
